{% extends 'theme/base.html' %}
{% block title %}Criar Trabalho{% endblock %}
{% block content %}

<h1 class="text-2xl font-bold mb-4">Criar Trabalho para QR ID {{ qr_code.id }}</h1>

<form method="POST">
  {% csrf_token %}

  <label class="block mb-2 font-medium">Tipo de Trabalho:</label>
  <select name="tipo_trabalho" id="tipo_trabalho" required class="border rounded p-2 mb-4 w-full">
    <option value="">-- Escolher --</option>
    <option value="desbasteAgulha">Desbaste Agulha</option>
    <option value="desbasteCalibre">Desbaste Calibre</option>
    <option value="polimento">Polimento</option>
    <option value="afinacao">Afinacao</option>
  </select>


  <label class="block mb-2 font-medium">Subtipo:</label>
  <select name="subtipo" id="subtipo" required class="border rounded p-2 mb-4 w-full">
    <option value="">-- Escolher o tipo primeiro --</option>
  </select>

  <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
    Criar Trabalho
  </button>
</form>

<script>
  const subtipoMap = JSON.parse('{{ subtipo_json|escapejs }}');
  const tipoSelect = document.getElementById('tipo_trabalho');
  const subtipoSelect = document.getElementById('subtipo');

  tipoSelect.addEventListener('change', () => {
    const tipo = tipoSelect.value;
    const opcoes = subtipoMap[tipo] || [];

    subtipoSelect.innerHTML = '<option value="">-- Escolher --</option>';
    opcoes.forEach(([valor, label]) => {
      const opt = document.createElement('option');
      opt.value = valor;
      opt.textContent = label;
      subtipoSelect.appendChild(opt);
    });
  });
</script>

{% endblock %}
  