{% extends 'theme/base.html' %}

{% block title %}Diametro Menu{% endblock %}

{% block content %}

<div class="max-w-xl mx-auto bg-white shadow-lg rounded-xl p-8 mt-10">
  <h1 class="text-3xl font-extrabold text-blue-700 mb-6 text-center">Novo Diâmetro</h1>
  <p class="text-gray-700 mb-6 text-center">Quantas fieiras são para levar um novo pedido?</p>

  <form id="diametroForm" method="POST" action="{% url 'diametroMenu' qr_code.toma_order_full %}">
    {% csrf_token %}

    <div class="mb-4">
      <input
        id="numeroAlterar"
        class="placeholder:text-gray-400 placeholder:italic border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
        placeholder="Número de fieiras a alterar"
        type="text"
        name="numeroAlterar"
      />
    </div>
    <div class="mb-4">
      <input
        id="diametroNovo"
        class="placeholder:text-gray-400 placeholder:italic border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
        placeholder="Diâmetro das fieiras"
        type="text"
        name="diametroNovo"
      />
    </div>
    <div class="mb-4">
      <input
        id="pedidoPor"
        class="placeholder:text-gray-400 placeholder:italic border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-400"
        placeholder="Pedido feito por"
        type="text"
        name="pedidoPor"
      />
    </div>

    <label class="block mb-2 font-semibold text-gray-700">Selecione os Números de Série dos Dies:</label>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
        {% for die in dies_existentes %}
            <label class="flex items-center space-x-2 bg-gray-50 rounded-lg p-2 hover:bg-blue-50 transition">
                <input type="checkbox" name="serieDies" value="{{ die.serial_number }}"
                      class="accent-blue-500 focus:ring-blue-400">
                <span class="text-gray-800">{{ die.serial_number }}</span>
            </label>
        {% empty %}
            <p class="text-gray-500 col-span-full">Nenhum die registrado para este QR code.</p>
        {% endfor %}
    </div>

    <div id="error-msg" class="hidden text-red-600 font-semibold mb-4"></div>

    <div class="flex justify-between items-center mt-6">
      <button
        type="submit"
        class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold shadow hover:bg-blue-700 transition-colors"
      >
        Submeter
      </button>
      <a href="{% url 'listarDies' %}" class="bg-gray-400 text-white px-6 py-2 rounded-lg font-semibold shadow hover:bg-gray-500 transition-colors">
        Sair
      </a>
    </div>
  </form>
</div>

<script>
  document.getElementById('diametroForm').addEventListener('submit', function (e) {
    const numero = document.getElementById('numeroAlterar').value.trim();
    const diametro = document.getElementById('diametroNovo').value.trim();
    const errorMsg = document.getElementById('error-msg');

    errorMsg.classList.add('hidden');
    errorMsg.textContent = '';

    if (!numero || isNaN(numero) || parseInt(numero) <= 0) {
      e.preventDefault();
      errorMsg.textContent = 'Insira um número válido de fieiras (maior que zero).';
      errorMsg.classList.remove('hidden');
      return;
    }

    if (!diametro || isNaN(diametro)) {
      e.preventDefault();
      errorMsg.textContent = 'Insira um diâmetro válido (número ou decimal).';
      errorMsg.classList.remove('hidden');
      return;
    }
  });
</script>
{% endblock %}
