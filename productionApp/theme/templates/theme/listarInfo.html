{% extends 'theme/base.html' %}
{% block title %}Registros de DeliveryInfo{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-black mb-8">Entregas Registradas</h1>

<!-- Barra de Pesquisa -->
<div class="mb-4">
    <input type="text" id="searchInput" placeholder="Pesquisar em todos os campos..."
           class="w-full md:w-1/2 px-4 py-2 border rounded shadow focus:outline-none focus:ring focus:ring-blue-300" />
</div>

<div class="overflow-x-auto w-full max-w-7xl bg-white rounded-lg shadow-lg p-6">
    <table id="deliveryTable" class="min-w-full table-auto text-xs md:text-sm text-left">
        <thead class="bg-custom-blue text-black">
            <tr>
                <th class="px-4 py-3">TOMA</th>
                <th class="px-4 py-3">Cliente</th>
                <th class="px-4 py-3">Tipo</th>
                <th class="px-4 py-3">Entidade</th>
                <th class="px-4 py-3">Data</th>
                <th class="px-4 py-3 text-center">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for d in deliveries %}
            <tr class="border-b hover:bg-gray-100 transition-colors">
                <td class="px-4 py-2">{{ d.identificator.toma_order_full }}</td>
                <td class="px-4 py-2">{{ d.costumer }}</td>
                <td class="px-4 py-2">{{ d.deliveryType.name }}</td>
                <td class="px-4 py-2">{{ d.deliveryEntity.name }}</td>
                <td class="px-4 py-2">{{ d.deliveryDate|date:"d/m/Y" }}</td>
                <td class="px-4 py-2 text-center">
                    <a href="{% url 'deliveryIdentification' d.identificator.toma_order_full %}" 
                       class="text-blue-600 hover:underline text-sm px-2">Editar</a>
                    <form method="POST" action="{% url 'deletar_delivery' d.id %}" style="display:inline;">
                        {% csrf_token %}
                        {% if request.user.groups.all.0.name in "Q-Office Administracao" %}
                        <button type="submit" class="text-red-600 hover:underline text-sm px-2"
                                onclick="return confirm('Tem certeza que deseja deletar este registro?')">
                            Excluir
                        </button>

                        {% endif %}
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center text-gray-500 py-4">Nenhuma entrega registrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchInput');
        const table = document.getElementById('deliveryTable').getElementsByTagName('tbody')[0];

        searchInput.addEventListener('keyup', function () {
            const filter = searchInput.value.toLowerCase();
            const rows = table.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let found = false;

                for (let j = 0; j < cells.length - 1; j++) {
                    if (cells[j].textContent.toLowerCase().includes(filter)) {
                        found = true;
                        break;
                    }
                }
                rows[i].style.display = found ? '' : 'none';
            }
        });
    });
</script>
{% endblock %}
